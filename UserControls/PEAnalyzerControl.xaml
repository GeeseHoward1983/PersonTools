<UserControl x:Class="MyTool.UserControls.PEAnalyzerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MyTool.UserControls"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800" AllowDrop="True" Drop="Grid_PreviewDragOver"  PreviewDragOver="Grid_PreviewDragOver">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 菜单栏 -->
        <Menu Grid.Row="0">
            <MenuItem Header="文件">
                <MenuItem Header="打开" Click="OpenFile_Click"/>
                <Separator/>
                <MenuItem Header="退出" Click="Exit_Click"/>
            </MenuItem>
        </Menu>

        <!-- PE分析内容 -->
        <TabControl Grid.Row="1" Margin="5">
            <!-- 文件信息和图标标签页 -->
            <TabItem Header="文件信息">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" MinHeight="350"/>
                        <RowDefinition Height="250" MinHeight="150"/>
                    </Grid.RowDefinitions>

                    <!-- 上方：PE头基本信息和附加信息 -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MinWidth="300"/>
                            <ColumnDefinition Width="*" MinWidth="300"/>
                        </Grid.ColumnDefinitions>

                        <!-- 左侧：PE头基本信息 -->
                        <GroupBox Grid.Column="0" Header="PE头信息" Margin="5">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Name="HeaderInfoPanel" Margin="5"/>
                            </ScrollViewer>
                        </GroupBox>

                        <!-- 右侧：附加信息 -->
                        <GroupBox Grid.Column="1" Header="附加信息" Margin="5">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Name="AdditionalInfoPanel" Margin="5"/>
                            </ScrollViewer>
                        </GroupBox>
                    </Grid>

                    <!-- 下方：图标信息 -->
                    <GroupBox Grid.Row="1" Header="图标信息" Margin="5">
                        <DataGrid Name="IconsDataGrid" AutoGenerateColumns="False" IsReadOnly="True" HeadersVisibility="Column">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="图标" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Image Source="{Binding ImageSource}" Width="64" Height="64" Stretch="Uniform"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="宽度" Binding="{Binding Width}" Width="80"/>
                                <DataGridTextColumn Header="高度" Binding="{Binding Height}" Width="80"/>
                                <DataGridTextColumn Header="色深" Binding="{Binding BitsPerPixel}" Width="80"/>
                                <DataGridTextColumn Header="大小(字节)" Binding="{Binding Size}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- 依赖和函数信息标签页 -->
            <TabItem Header="依赖和函数">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" MinWidth="200"/>
                        <ColumnDefinition Width="2*" MinWidth="400"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左侧：依赖信息 -->
                    <GroupBox Grid.Column="0" Header="动态库依赖" Margin="5">
                        <TreeView Name="DependencyTree" MouseDoubleClick="DependencyTree_MouseDoubleClick"/>
                    </GroupBox>

                    <!-- 右侧：导入和导出函数 -->
                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" MinHeight="200"/>
                            <RowDefinition Height="*" MinHeight="200"/>
                        </Grid.RowDefinitions>

                        <!-- 右上：导入函数 -->
                        <GroupBox Grid.Row="0" Header="导入函数列表" Margin="5">
                            <DataGrid Name="ImportFunctionsGrid" AutoGenerateColumns="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="DLL名称" Binding="{Binding DllName}" Width="150"/>
                                    <DataGridTextColumn Header="函数名称" Binding="{Binding FunctionName}" Width="*"/>
                                    <DataGridTextColumn Header="序号" Binding="{Binding OrdinalDisplay}" Width="120">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="导入类型" Binding="{Binding IsOrdinalImport}" Width="80"/>
                                    <DataGridTextColumn Header="延迟加载" Binding="{Binding IsDelayLoaded}" Width="80"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>

                        <!-- 右下：导出函数 -->
                        <GroupBox Grid.Row="1" Header="导出函数列表" Margin="5">
                            <DataGrid Name="ExportFunctionsGrid" AutoGenerateColumns="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="函数名称" Binding="{Binding Name}" Width="*"/>
                                    <DataGridTextColumn Header="序号" Binding="{Binding OrdinalDisplay}" Width="120">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="RVA" Binding="{Binding RVA, StringFormat=0x\{0:X8\}}" Width="100"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>